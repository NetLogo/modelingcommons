<% @title = @model.name %>

<div id="preview-image-div"> <img id="preview-image" align="right" src="<%= url_for :controller => "browse", :action => "display_preview", :id => @model.id %>"></div>

<script type="text/javascript">

  // initialise plugins
  jQuery(function(){

  // Start Superfish menu
  jQuery('ul.sf-menu').superfish({ pathClass: 'current' });

  // Function to handle clicks
  handle_menu_click = function() {
  console.log($(this).parent());

  if (this.hash == '')
  {
  return false;
  }

  $('.one-model-div').hide();     // Hide all of the divs
  $('a').removeClass('current');  // Remove "current" class

  $(this).addClass('current');
  $(this.hash).show(); // Show the one for what was clicked on
  return false;
  }

  $('ul.sf-menu li a').click(handle_menu_click);
  $('ul.sf-menu li ul li a').click(handle_menu_click);
  });

</script>

<div id="menu-div">
  <ul class="sf-menu sf-navbar">
    <li>
      <a href="">Model</a>
      <ul>
        <li><a id="info-menu" href="#info-div">Info</a></li>
        <li><a id="related-menu" href="#related-div">Related</a></li>
        <li><a id="files-menu" href="#files-div">Files</a></li>
        <li><a id="procedures-menu" href="#procedures-div">Procedures</a></li>
        <li><a id="gui-menu" href="#gui-div">GUI</a></li>
        <li><a id="applet-menu" href="#applet-div">Applet</a></li>
      </ul>
    </li>

    <li><a id="download-menu" href="#download-div">Download</a></li>

    <li><a id="upload-menu" href="">Upload</a>
      <ul>
        <li><a href="#upload-version-div">Upload new version</a></li>
        <li><a href="#upload-file-div">Upload related file</a></li>
      </ul>
    </li>

    <li><a href="#permissions-div">Permissions</a></li>

    <li>
      <a href="">Groups</a>
      <ul>
        <li><a href="#groups-your-div">Your groups</a></li>
        <li><a href="#groups-find-div">Find</a></li>
        <li><a href="#groups-create-div">Create</a></li>
        <li><a href="#groups-manage-div">Manage</a></li>
      </ul>
    </li>

    <li><a href="#history-div">History</a></li>
    <li><a href="#discuss-div">Discuss</a></li>
    <li><a href="#tags-div">Tags</a></li>

  </ul>
</div>

<!-- Model menu -->
<div id="info-div" class="one-model-div">
  <%= render :partial => "info_div", :locals => {:model => @model} -%>
</div>

<div id="related-div" class="one-model-div">
  <% if @model.parent.nil? -%>
  <p>No parent node</p>
  <% else -%>
  <p><b>Parent:</b> <%= link_to @model.parent.name, :controller => 'browse', :action => 'one_model', :id => @model.parent.id  -%></p>
  <% end -%>

  <% if @model.models.empty? -%>
  <p>No child nodes</p>
  <% else -%>
  <h3>Children:</h3>
  <ul>
    <% @model.models.each do |child| -%>
    <li><%= link_to child.name, :controller => 'browse', :action => 'one_model', :id => child.id  -%></li>
    <% end -%>
  </ul>
  <% end -%>

</div>

<div id="files-div" class="one-model-div">
  <% if @model.files.empty? -%>
  <p>No files</p>
  <% else -%>
  <ul>
    <% @model.files.sort_by {|f| f.name}.each do |f| -%>
    <li><%= link_to f.filename, :controller => :browse, :action => :one_node, :id => f.id -%> (<%= f.node_type.short_name -%>)</li>
    <% end -%>
  </ul>
  <% end -%>

</div>

<div id="procedures-div" class="one-model-div">
  <p><%= @model.procedures_tab(with_html=true) -%></p>
</div>

<div id="gui-div" class="one-model-div">
  <p><%= @model.gui_tab(with_html=true) -%></p>
</div>

<div id="applet-div" class="one-model-div">
  <p><%= link_to "Launch applet", {:controller => :browse, :action => :one_applet, :id => @model.id}, {:popup => ["width=#{@model.dimensions[:width]}", "height=#{@model.dimensions[:height] + 150}"] }  -%></p>
</div>

<!-- Download menu -->
<div id="download-div" class="one-model-div">
  <p>Download div</p>
</div>

<!-- Upload menu -->
<div id="upload-version-div" class="one-model-div">
  <p>Upload version div</p>
</div>

<div id="upload-file-div" class="one-model-div">
  <p>Upload file div</p>
</div>

<!-- Permissions menu -->
<div id="permissions-div" class="one-model-div">
  <p>Permissions div</p>
</div>

<!-- Groups menu -->
<div id="groups-your-div" class="one-model-div">
  <p>Your groups div</p>
</div>

<div id="groups-find-div" class="one-model-div">
  <p>Find groups div</p>
</div>

<div id="groups-create-div" class="one-model-div">
  <p>Create groups div</p>
</div>

<div id="groups-manage-div" class="one-model-div">
  <p>Manage groups div</p>
</div>

<!-- History menu -->
<div id="history-div" class="one-model-div">
  <p>History div</p>
</div>

<!-- Discuss menu -->
<div id="discuss-div" class="one-model-div">
  <p>Discuss div</p>
</div>

<%= render :partial => "model_tab", :locals => {:model => @model} -%>

<div id="download-div" class="main-div" style="display:none;">
  <h2>Download the latest version</h2>
  <%= link_to "Download model (as a zip file)", :controller => "browse", :action => "download_model", :id => @model.id -%>
</div>

<div id="upload-div" class="main-div" style="display:none;">
  <%= render :partial => "upload_form", :locals => {:node => @model} -%>
</div>

<div id="discuss-div" class="main-div" style="display:none;">
  <%= render :partial => "discussion", :locals => {:node => @model} -%>
</div>

<div id="permissions-div" class="main-div" style="display:none;">
  <%= render :partial => "permissions", :locals => {:model => @model} -%>
</div>

<%= render :partial => "groups", :locals => {:model => @model} -%>

<div id="history-div" class="main-div" style="display:none;">
  <%= render :partial => "history", :locals => {:node => @model} -%>
</div>

<!-- Tags menu -->
<div id="tags-div" class="one-model-div">
  <%= render :partial => "tags", :locals => {:node => @model} -%>
</div>
